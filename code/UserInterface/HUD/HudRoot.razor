@using Sandbox;
@using Sandbox.UI;
@using System;
@attribute [Title( "Player HUD Element" )]
@attribute [Icon( "screen_share" )]
@attribute [Group( "Physbox" )]
@attribute [Tint( EditorTint.Yellow )]
@inherits PanelComponent
@namespace Physbox

@if ( Player is null || IsProxy || !DrawHud ) return;
@if ( PauseMenu.Paused ) return;

<root>
	@if ( GameLogicComponent.UseTimer &&
	      !Game.RoundOver &&
	      Game.GameModeComponent is not null )
	{
		<Timer/>
	}

	@if ( Input.Down( "score" ) )
	{
		<Scoreboard/>
	}

	@if ( Game.RoundOver && Game.GameModeComponent.HasWinner )
	{
		<WinnerDisplay/>
	}

	@if ( Player.IsAlive )
	{
		switch ( GameLogicComponent.GameMode )
		{
			case GameModes.Deathmatch:
				<Health/>
				<Score/>
				break;
			case GameModes.Dodgeball:
				<Lives/> break;
		}


		@if ( !Input.Down( "score" ) )
		{
			<PropSelector/>
		}

		@if ( Player.HeldGameObject is not null )
		{
			<Charge/>
			<HeldProp/>
		}
	}
	else
	{
		<DeadMessage/>
	}
</root>

@code
{
	[ConVar( "pb_player_drawhud", ConVarFlags.Cheat )]
	public static bool DrawHud { get; set; } = true;

	PlayerComponent Player => PlayerComponent.LocalPlayer;
	GameLogicComponent Game => GameLogicComponent.GetGameInstance();

	/// <summary>
	/// the hash determines if the system should be rebuilt. If it changes, it will be rebuilt
	/// </summary>
	protected override int BuildHash()
	{
		return HashCode.Combine( Time.Now );
	}
}
